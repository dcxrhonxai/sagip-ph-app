const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/web-D6xGk0Tg.js","assets/index-BtLN2Uql.js","assets/query-B7TAEhb4.js","assets/react-DkRoLQX_.js","assets/supabase-DUpyXQ4O.js","assets/index-BeWRLoz9.css"])))=>i.map(i=>d[i]);
import{r as O,C as A,W as N}from"./index-BtLN2Uql.js";import{_ as D}from"./supabase-DUpyXQ4O.js";function I(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return new Proxy({},{get(n,i){return(o,a,c)=>{const s=r.Capacitor.Plugins[t];if(s===void 0){c(new Error(`Capacitor plugin ${t} not found`));return}if(typeof s[i]!="function"){c(new Error(`Method ${i} not found in Capacitor plugin ${t}`));return}(async()=>{try{const d=await s[i](o);a(d)}catch(d){c(d)}})()}}})}})}function F(r){r.CapacitorUtils.Synapse=new Proxy({},{get(e,t){return r.cordova.plugins[t]}})}function M(r=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!r?I(window):window.cordova!==void 0&&F(window))}var E;(function(r){r.Documents="DOCUMENTS",r.Data="DATA",r.Library="LIBRARY",r.Cache="CACHE",r.External="EXTERNAL",r.ExternalStorage="EXTERNAL_STORAGE",r.ExternalCache="EXTERNAL_CACHE",r.LibraryNoCloud="LIBRARY_NO_CLOUD",r.Temporary="TEMPORARY"})(E||(E={}));var _;(function(r){r.UTF8="utf8",r.ASCII="ascii",r.UTF16="utf16"})(_||(_={}));const p=O("Filesystem",{web:()=>D(()=>import("./web-D6xGk0Tg.js"),__vite__mapDeps([0,1,2,3,4,5])).then(r=>new r.FilesystemWeb)});M();const U=O("BlobWriter");function L(r){return window.btoa(Array.from(new Uint8Array(r)).map(function(e){return String.fromCharCode(e)}).join(""))}function x({path:r,directory:e,blob:t,recursive:n}){return p.writeFile({directory:e,path:r,recursive:n,data:""}).then(function(){return new Promise(function(i,o){function a(s){o(s.target.error)}const c=window.indexedDB.open("Disc");c.onerror=a,c.onsuccess=function(){const d=c.result.transaction("FileStorage","readwrite");d.onerror=a;const R=d.objectStore("FileStorage"),h=`/${e}/${r.replace(/^\//,"")}`,m=R.get(h);m.onsuccess=function(){m.result.size=t.size,m.result.content=t;const w=R.put(m.result);w.onsuccess=function(){i(void 0)}}}})})}function y({path:r,directory:e,blob:t,recursive:n}){return p.writeFile({directory:e,path:r,recursive:n,data:""}).then(function i(){if(t.size===0)return Promise.resolve();const o=384*1024,a=t.slice(0,o);return t=t.slice(o),new Response(a).arrayBuffer().then(function(s){return p.appendFile({directory:e,path:r,data:L(s)})}).then(i)})}function B(r){const{path:e,directory:t,blob:n,fast_mode:i=!1,recursive:o,on_fallback:a}=r;return!n||!Number.isSafeInteger(n.size)||typeof n.type!="string"?Promise.reject(new Error("Not a Blob.")):A.getPlatform()==="web"?i?x(r):y(r):Promise.all([U.get_config(),p.getUri({path:e,directory:t})]).then(function([c,s]){const d=s.uri.replace("file://","");return(window.CapacitorWebFetch||window.fetch)(c.base_url+d+(o?"?recursive=true":""),{headers:{authorization:c.auth_token},method:"put",body:n}).then(function(h){if(h.status!==204)throw new Error("Bad HTTP status: "+h.status);return s.uri})}).catch(function(s){return a!==void 0&&a(s),y(r)})}const k=Object.freeze(B);function $(r){const e=document.createElement("video");if(!e)throw new Error("Failed to create video element");const t=new Promise((n,i)=>{e.addEventListener("loadedmetadata",()=>{e.duration===1/0?(e.currentTime=Number.MAX_SAFE_INTEGER,e.ontimeupdate=()=>{e.ontimeupdate=null,n(e.duration),e.currentTime=0}):n(e.duration)}),e.onerror=o=>{const a=o.error||new Error("Unknown error occurred");i(a)}});return e.src=typeof r=="string"?r:URL.createObjectURL(r),t}const l=()=>({value:!0}),g=()=>({value:!1}),z=()=>new Error("MISSING_PERMISSION"),G=()=>new Error("ALREADY_RECORDING"),W=()=>new Error("DEVICE_CANNOT_VOICE_RECORD"),P=()=>new Error("FAILED_TO_RECORD"),Y=()=>new Error("EMPTY_RECORDING"),f=()=>new Error("RECORDING_HAS_NOT_STARTED"),b=()=>new Error("FAILED_TO_FETCH_RECORDING"),S=()=>new Error("COULD_NOT_QUERY_PERMISSION_STATUS"),T={"audio/aac":".aac","audio/webm;codecs=opus":".ogg","audio/mp4":".mp3","audio/webm":".ogg","audio/ogg;codecs=opus":".ogg"},C=()=>new Promise(()=>{});class u{constructor(){this.mediaRecorder=null,this.chunks=[],this.pendingResult=C()}static async canDeviceVoiceRecord(){var e;return((e=navigator?.mediaDevices)===null||e===void 0?void 0:e.getUserMedia)==null||u.getSupportedMimeType()==null?g():l()}async startRecording(e){if(this.mediaRecorder!=null)throw G();if(!(await u.canDeviceVoiceRecord()).value)throw W();if(!(await u.hasAudioRecordingPermission().catch(()=>l())).value)throw z();return navigator.mediaDevices.getUserMedia({audio:!0}).then(i=>this.onSuccessfullyStartedRecording(i,e)).catch(this.onFailedToStartRecording.bind(this))}async stopRecording(){if(this.mediaRecorder==null)throw f();try{return this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(e=>e.stop()),this.pendingResult}catch{throw b()}finally{this.prepareInstanceForNextOperation()}}static async hasAudioRecordingPermission(){return!navigator.permissions.query&&navigator.mediaDevices!==void 0?navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>l()).catch(()=>{throw S()}):navigator.permissions.query({name:"microphone"}).then(e=>({value:e.state==="granted"})).catch(()=>{throw S()})}static async requestAudioRecordingPermission(){return(await u.hasAudioRecordingPermission().catch(()=>g())).value?l():navigator.mediaDevices.getUserMedia({audio:!0}).then(()=>l()).catch(()=>g())}pauseRecording(){if(this.mediaRecorder==null)throw f();return this.mediaRecorder.state==="recording"?(this.mediaRecorder.pause(),Promise.resolve(l())):Promise.resolve(g())}resumeRecording(){if(this.mediaRecorder==null)throw f();return this.mediaRecorder.state==="paused"?(this.mediaRecorder.resume(),Promise.resolve(l())):Promise.resolve(g())}getCurrentStatus(){return this.mediaRecorder==null?Promise.resolve({status:"NONE"}):this.mediaRecorder.state==="recording"?Promise.resolve({status:"RECORDING"}):this.mediaRecorder.state==="paused"?Promise.resolve({status:"PAUSED"}):Promise.resolve({status:"NONE"})}static getSupportedMimeType(){if(MediaRecorder?.isTypeSupported==null)return null;const e=Object.keys(T).find(t=>MediaRecorder.isTypeSupported(t));return e??null}onSuccessfullyStartedRecording(e,t){return this.pendingResult=new Promise((n,i)=>{this.mediaRecorder=new MediaRecorder(e),this.mediaRecorder.onerror=()=>{this.prepareInstanceForNextOperation(),i(P())},this.mediaRecorder.onstop=async()=>{var o,a,c;const s=u.getSupportedMimeType();if(s==null){this.prepareInstanceForNextOperation(),i(b());return}const d=new Blob(this.chunks,{type:s});if(d.size<=0){this.prepareInstanceForNextOperation(),i(Y());return}let R,h="";if(t?.directory){const v=`${(c=(a=(o=t.subDirectory)===null||o===void 0?void 0:o.match(/^\/?(.+[^/])\/?$/))===null||a===void 0?void 0:a[1])!==null&&c!==void 0?c:""}/recording-${new Date().getTime()}${T[s]}`;await k({blob:d,directory:t.directory,fast_mode:!0,path:v,recursive:!0}),{uri:R}=await p.getUri({directory:t.directory,path:v})}else h=await u.blobToBase64(d);const m=await $(d);this.prepareInstanceForNextOperation(),n({value:{recordDataBase64:h,mimeType:s,msDuration:m*1e3,uri:R}})},this.mediaRecorder.ondataavailable=o=>this.chunks.push(o.data),this.mediaRecorder.start()}),l()}onFailedToStartRecording(){throw this.prepareInstanceForNextOperation(),P()}static blobToBase64(e){return new Promise(t=>{const n=new FileReader;n.onloadend=()=>{const i=String(n.result),o=i.split("base64,"),a=o.length>1?o[1]:i;t(a.trim())},n.readAsDataURL(e)})}prepareInstanceForNextOperation(){if(this.mediaRecorder!=null&&this.mediaRecorder.state==="recording")try{this.mediaRecorder.stop()}catch{console.warn("Failed to stop recording during cleanup")}this.pendingResult=C(),this.mediaRecorder=null,this.chunks=[]}}class j extends N{constructor(){super(...arguments),this.voiceRecorderInstance=new u}canDeviceVoiceRecord(){return u.canDeviceVoiceRecord()}hasAudioRecordingPermission(){return u.hasAudioRecordingPermission()}requestAudioRecordingPermission(){return u.requestAudioRecordingPermission()}startRecording(e){return this.voiceRecorderInstance.startRecording(e)}stopRecording(){return this.voiceRecorderInstance.stopRecording()}pauseRecording(){return this.voiceRecorderInstance.pauseRecording()}resumeRecording(){return this.voiceRecorderInstance.resumeRecording()}getCurrentStatus(){return this.voiceRecorderInstance.getCurrentStatus()}}const q=Object.freeze(Object.defineProperty({__proto__:null,VoiceRecorderWeb:j},Symbol.toStringTag,{value:"Module"}));export{_ as E,q as w};
