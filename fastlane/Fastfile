# fastlane/Fastfile for sagip-ph-app
# Builds debug & release APK and AAB, no Play Store upload

default_platform(:android)

platform :android do

  desc "Build both Debug and Release APK & AAB"
  lane :build_all do

    # Dynamically set JAVA_HOME based on platform
    if RbConfig::CONFIG['host_os'] =~ /mswin|mingw|cygwin/
      # Windows local path
      ENV["JAVA_HOME"] ||= "C:\\Progra~1\\Java\\jdk-17"
    else
      # Linux CI/Appflow path
      ENV["JAVA_HOME"] ||= "/usr/lib/jvm/java-17-openjdk-amd64"
    end

    UI.message("ℹ️ JAVA_HOME is set to: #{ENV['JAVA_HOME']}")

    UI.message("ℹ️ Starting Debug build...")
    gradle(
      task: "assembleDebug",
      project_dir: "./android"
    )
    gradle(
      task: "bundleDebug",
      project_dir: "./android"
    )
    UI.success("✅ Debug build finished. APK & AAB located in android/app/build/outputs/")

    UI.message("ℹ️ Starting Release build...")
    gradle(
      task: "assembleRelease",
      project_dir: "./android"
    )
    gradle(
      task: "bundleRelease",
      project_dir: "./android"
    )
    UI.success("✅ Release build finished. APK & AAB located in android/app/build/outputs/")
  end

end
